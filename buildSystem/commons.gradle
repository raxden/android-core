task increaseBuildVersion {
    doLast {
        println(":increaseBuildVersion - Incrementing build version...")
        increaseBuildVersion()
        exec { commandLine "git", "pull" }
        exec { commandLine "git", "add", "-A" }
        exec { commandLine "git", "commit", "-m", "Build version increased" }
        exec { commandLine "git", "push" }
        println(":increaseBuildVersion - Build version incremented.")
    }
}

void increaseBuildVersion() {
    def gradlePropsFile = file('gradle.properties')
    if (gradlePropsFile.isFile() && gradlePropsFile.canRead()) {
        Properties versionProps = new Properties()
        versionProps.load(new FileInputStream(gradlePropsFile))
        def buildVersion = Integer.parseInt(versionProps['VERSION_CODE']) + 1
        versionProps['VERSION_CODE'] = buildVersion.toString()
        versionProps.store(gradlePropsFile.newWriter(), null)
    } else {
        throw new GradleException(":increaseBuildVersion - Could not read gradle.properties!")
    }
}